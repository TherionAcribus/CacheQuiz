<div class="conversations" id="conversations">
  {% if not items %}
  <div class="placeholder">Aucune conversation pour le moment.</div>
  {% else %}
  <ul class="conv-list" style="list-style:none;margin:0;padding:0">
    {% for conv, last_msg, unread_count in items %}
    <li class="conv-item {% if unread_count > 0 %}unread{% else %}read{% endif %}" style="border-bottom:1px solid var(--border-color)">
      <a href="#" class="conv-link" hx-get="/api/messages/thread/{{ conv.id }}" hx-target="#thread" hx-swap="innerHTML" style="display:block;padding:0.75rem 1rem;text-decoration:none;color:inherit">
        <div class="conv-title" style="display:flex;justify-content:space-between;gap:.5rem;align-items:center">
          <span class="{% if unread_count > 0 %}unread-title{% endif %}">{{ conv.subject or 'Conversation' }}</span>
          {% if unread_count > 0 %}<span class="badge unread-badge">{{ unread_count }}</span>{% endif %}
        </div>
        <div class="conv-last {% if unread_count > 0 %}unread-text{% endif %}" style="font-size:.9rem;margin-top:.25rem">
          {% if last_msg %}
            {{ last_msg.sender.username if last_msg.sender else 'Système' }}: {{ (last_msg.content or '')[:80] }}{% if (last_msg.content or '')|length > 80 %}…{% endif %}
          {% else %}
            Aucun message
          {% endif %}
        </div>
      </a>
    </li>
    {% endfor %}
  </ul>
  {% endif %}
</div>

<style>
.conv-item.unread {
  background-color: #e3f2fd !important;
  border-left: 4px solid #2196f3 !important;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.conv-item.read {
  background-color: #f8f9fa !important;
  border-left: 4px solid transparent !important;
}

.unread-title {
  font-weight: bold !important;
  color: #1976d2 !important;
}

.unread-text {
  color: #424242 !important;
  font-weight: 500 !important;
}

.conv-item.read .conv-title span {
  color: #9e9e9e !important;
  font-weight: normal !important;
}

.conv-item.read .conv-last {
  color: #9e9e9e !important;
  font-weight: normal !important;
}

.unread-badge {
  background-color: #f44336 !important;
  color: white !important;
  border-radius: 50% !important;
  padding: 0.2rem 0.5rem !important;
  font-size: 0.75rem !important;
  font-weight: bold !important;
  min-width: 1.2rem !important;
  text-align: center !important;
  display: inline-block !important;
}

.badge {
  background-color: #757575 !important;
  color: white !important;
  border-radius: 0.25rem !important;
  padding: 0.1rem 0.4rem !important;
  font-size: 0.75rem !important;
  font-weight: bold !important;
}
</style>

