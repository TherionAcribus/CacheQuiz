{% if questions %}
<div class="questions-grid">
    {% for question in questions %}
    <div class="question-card">
        <div class="question-header">
            <div class="question-meta">
                {% if question.theme %}
                <span class="badge badge-theme" {% if question.theme.color %}style="background-color: {{ question.theme.color }}20; color: {{ question.theme.color }}; border: 1px solid {{ question.theme.color }}"{% endif %}>
                    {% if question.theme.icon %}{{ question.theme.icon }} {% endif %}{{ question.theme.name }}
                </span>
                {% if question.specific_theme_obj %}
                <span class="badge badge-specific-theme" {% if question.specific_theme_obj.color %}style="background-color: {{ question.specific_theme_obj.color }}20; color: {{ question.specific_theme_obj.color }}; border: 1px solid {{ question.specific_theme_obj.color }}"{% endif %}>
                    {% if question.specific_theme_obj.icon %}{{ question.specific_theme_obj.icon }} {% endif %}{{ question.specific_theme_obj.name }}
                </span>
                {% endif %}
                {% else %}
                <span class="badge badge-theme">Sans th√®me</span>
                {% endif %}
                <span class="badge badge-difficulty">Niveau {{ question.difficulty_level or 'N/A' }}</span>
                {% if question.is_published %}
                <span class="badge badge-published">En ligne</span>
                {% else %}
                <span class="badge badge-draft">Brouillon</span>
                {% endif %}
            </div>
            <div class="question-actions">
                <button class="btn-icon" 
                        type="button"
                        onclick="document.getElementById('question-form-container').classList.remove('hidden')"
                        hx-get="/question/{{ question.id }}/edit"
                        hx-target="#question-form-container"
                        hx-swap="innerHTML"
                        title="√âditer">
                    ‚úèÔ∏è
                </button>
                <button class="btn-icon btn-danger" 
                        hx-delete="/api/question/{{ question.id }}"
                        hx-target="#questions-list"
                        hx-confirm="√ätes-vous s√ªr de vouloir supprimer cette question ?"
                        title="Supprimer">
                    üóëÔ∏è
                </button>
            </div>
        </div>
        
        <div class="question-content">
            <h3>{{ question.question_text }}</h3>
            <div class="question-info">
                <p><strong>Auteur:</strong> {{ question.author_user.display_name if question.author_user else 'Auteur inconnu' }}</p>
                {% if question.hint %}
                <p><strong>Indice:</strong> {{ question.hint }}</p>
                {% endif %}
                {% if question.countries %}
                <p><strong>Pays:</strong> 
                    {% for country in question.countries %}
                        {% if country.flag %}{{ country.flag }} {% endif %}{{ country.name }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </p>
                {% endif %}
            </div>
            
            {% set answers = question.possible_answers.split('|||') %}
            {% if answers %}
            <div class="answers-preview">
                <strong>R√©ponses possibles:</strong>
                <ul>
                    {% for answer in answers %}
                    <li {% if loop.index == question.correct_answer|int %}class="correct-answer"{% endif %}>
                        {{ answer }}
                        {% set link = (question.answer_image_links | selectattr('answer_index','equalto', loop.index) | list) %}
                        {% if link and link[0] and link[0].image %}
                        <img src="/uploads/{{ link[0].image.filename }}" alt="{{ link[0].image.alt_text or link[0].image.title }}" style="max-width:80px; max-height:80px; object-fit:contain; margin-left:.5rem; vertical-align:middle;" />
                        {% endif %}
                        {% if loop.index == question.correct_answer|int %}‚úì{% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            {% if question.images %}
            <div class="question-images">
                <strong>Images:</strong>
                <div class="image-row">
                    {% for img in question.images %}
                    <img src="/uploads/{{ img.filename }}" alt="{{ img.alt_text or img.title }}" title="{{ img.title }}" style="max-width:100px; max-height:100px; object-fit:cover; border:1px solid var(--border-color); border-radius:.25rem; margin-right:.5rem;" />
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            {% if question.detailed_answer %}
            <div class="detailed-answer">
                <strong>Explication:</strong>
                <p>{{ question.detailed_answer }}</p>
            </div>
            {% endif %}
        </div>
        
        <div class="question-footer">
            <small>Cr√©√©: {{ question.created_at.strftime('%d/%m/%Y %H:%M') if question.created_at }}</small>
            <small>Modifi√©: {{ question.updated_at.strftime('%d/%m/%Y %H:%M') if question.updated_at }}</small>
            {% if question.times_answered > 0 %}
            <small>R√©ussite: {{ "%.1f"|format(question.success_rate) }}% ({{ question.times_answered }} r√©ponses)</small>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="no-questions">
    <p>üìã Aucune question trouv√©e. Commencez par en cr√©er une !</p>
</div>
{% endif %}

<style>
    .badge-specific-theme {
        background-color: #fef3c7;
        color: #92400e;
        font-weight: 500;
    }
</style>

