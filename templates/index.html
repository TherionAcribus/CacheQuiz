{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h2>Base de donnÃ©es des questions</h2>
    <div class="header-actions">
        <input type="text"
               id="search-input"
               placeholder="Rechercher une question..."
               hx-get="/api/questions/search"
               hx-trigger="keyup changed delay:500ms"
               hx-target="#questions-list"
               hx-include="this"
               name="q">

        <div class="view-toggle">
            <button class="btn btn-secondary" id="view-cards" onclick="toggleView('cards')">
                ðŸ“‹ Cartes
            </button>
            <button class="btn btn-secondary" id="view-table" onclick="toggleView('table')">
                ðŸ“Š Tableau
            </button>
        </div>

        <button class="btn btn-primary"
                onclick="document.getElementById('question-form-container').classList.remove('hidden')"
                hx-get="/question/new"
                hx-target="#question-form-container"
                hx-swap="innerHTML">
            + Nouvelle Question
        </button>
    </div>
</div>

<!-- Conteneur pour le formulaire (cachÃ© par dÃ©faut) -->
<div id="question-form-container" class="hidden form-modal">
    <!-- Le formulaire sera chargÃ© ici via HTMX -->
</div>

<!-- Liste des questions -->
<div id="questions-list" 
     hx-get="/questions" 
     hx-trigger="load"
     hx-swap="innerHTML">
    <div class="loading">Chargement des questions...</div>
</div>

<style>
    .hidden {
        display: none;
    }
    
    .form-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        overflow-y: auto;
    }
    
    .form-modal.hidden {
        display: none;
    }

    .view-toggle {
        display: flex;
        gap: 0.25rem;
    }

    .view-toggle .btn {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
    }

    .view-toggle .btn.active {
        background-color: var(--primary-color);
        color: white;
    }
</style>

<script>
let currentView = localStorage.getItem('questionsView') || 'cards';

function toggleView(viewType) {
    currentView = viewType;

    // Mettre Ã  jour les boutons actifs
    document.getElementById('view-cards').classList.toggle('active', viewType === 'cards');
    document.getElementById('view-table').classList.toggle('active', viewType === 'table');

    // Sauvegarder la prÃ©fÃ©rence dans le localStorage
    localStorage.setItem('questionsView', viewType);

    // Recharger la liste avec la nouvelle vue
    const searchInput = document.getElementById('search-input');
    const searchValue = searchInput.value.trim();

    let url;
    if (searchValue) {
        url = `/api/questions/search?q=${encodeURIComponent(searchValue)}&view=${viewType}`;
    } else {
        url = `/questions?view=${viewType}`;
    }

    htmx.ajax('GET', url, {target: '#questions-list'});
}

// AprÃ¨s chaque requÃªte HTMX qui met Ã  jour la liste, s'assurer que la vue reste cohÃ©rente
document.addEventListener('htmx:afterSwap', function(event) {
    if (event.target.id === 'questions-list') {
        // Mettre Ã  jour les boutons de vue pour reflÃ©ter l'Ã©tat actuel
        document.getElementById('view-cards').classList.toggle('active', currentView === 'cards');
        document.getElementById('view-table').classList.toggle('active', currentView === 'table');
    }
});

// Initialiser la vue au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    const savedView = localStorage.getItem('questionsView') || 'cards';
    currentView = savedView;
    toggleView(savedView);
});
</script>
{% endblock %}

