{% extends "base_public.html" %}

{% block content %}
<div class="preferences-page">
  <h2>Mes préférences</h2>

  <!-- Afficher les messages flash -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ 'danger' if category == 'error' else category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="preferences-form">
    <form method="POST">
      <div class="form-group">
        <label for="username">Pseudo</label>
        <input type="text" id="username" value="{{ user.username }}" readonly class="form-control">
        <small class="form-text">Le pseudo ne peut pas être modifié.</small>
      </div>

      <div class="form-group">
        <label for="email">Adresse email</label>
        <input type="email" id="email" name="email" value="{{ user.email or '' }}" class="form-control" placeholder="votre.email@exemple.com">
        <small class="form-text">Optionnel. Utilisé pour la récupération de mot de passe.</small>
      </div>

      <div class="form-group">
        <label for="created_at">Date de création du compte</label>
        <input type="text" id="created_at" value="{{ user.created_at.strftime('%d/%m/%Y %H:%M') }}" readonly class="form-control">
      </div>

      <button type="submit" class="btn btn-primary">Enregistrer les modifications</button>
    </form>
  </div>

  <div class="preferences-actions">
    <a href="/me" class="btn btn-secondary">Voir mes statistiques</a>
  </div>

  <div class="danger-zone">
    <h3>Zone de danger</h3>
    <p class="danger-text">⚠️ Cette action est irréversible. Toutes vos données seront supprimées définitivement.</p>
    <button type="button" class="btn btn-danger" onclick="showDeleteModal()">
      Supprimer mon compte définitivement
    </button>
  </div>

  <!-- Modale de confirmation de suppression -->
  <div id="deleteModal" class="modal-overlay">
    <div class="modal-content" style="padding: 2rem;">
      <h3 style="color: var(--danger-color); margin-bottom: 1rem;">⚠️ Confirmer la suppression</h3>
      <p style="margin-bottom: 1.5rem; line-height: 1.6;">
        Vous êtes sur le point de supprimer définitivement votre compte <strong>{{ user.username }}</strong>.<br><br>
        Cette action entraînera :
      </p>
      <ul style="margin-bottom: 2rem; color: var(--text-color);">
        <li>• La suppression de toutes vos statistiques</li>
        <li>• La suppression de votre historique de jeu</li>
        <li>• La perte définitive de votre compte</li>
        <li>• L'impossibilité de récupérer vos données</li>
      </ul>
      <p style="color: var(--danger-color); font-weight: bold; margin-bottom: 2rem;">
        Cette action est IRRÉVERSIBLE !
      </p>
      <div style="display: flex; gap: 1rem; justify-content: flex-end;">
        <button type="button" class="btn btn-secondary" onclick="hideDeleteModal()">Annuler</button>
        <form method="POST" action="/delete-account" style="display: inline;">
          <button type="submit" class="btn btn-danger" style="min-width: 120px;">
            Supprimer définitivement
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
.preferences-page {
  max-width: 600px;
  margin: 0 auto;
}

.preferences-form {
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  padding: 2rem;
  border-radius: 8px;
  margin-bottom: 2rem;
  box-shadow: var(--shadow);
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  color: var(--primary-color);
  font-weight: bold;
}

.form-control {
  width: 100%;
  padding: 0.75rem;
  border: 2px solid var(--border-color);
  border-radius: 0.5rem;
  background-color: var(--card-bg);
  color: var(--text-color);
  font-size: 1rem;
}

.form-control:focus {
  outline: none;
  border-color: var(--primary-color);
  background-color: var(--bg-color);
}

.form-control[readonly] {
  background-color: var(--bg-color);
  cursor: not-allowed;
  opacity: 0.7;
}

.form-text {
  display: block;
  margin-top: 0.25rem;
  color: var(--text-light);
  font-size: 0.875rem;
}

.preferences-actions {
  text-align: center;
}

.alert {
  padding: 1rem;
  border-radius: 0.5rem;
  margin-bottom: 1rem;
  font-weight: bold;
}

.alert-success {
  background-color: #d4edda;
  border: 1px solid #c3e6cb;
  color: #155724;
}

.alert-danger {
  background-color: #f8d7da;
  border: 1px solid #f5c6cb;
  color: #721c24;
}

.alert-warning {
  background-color: #fff3cd;
  border: 1px solid #ffeaa7;
  color: #856404;
}

.danger-zone {
  margin-top: 3rem;
  padding: 2rem;
  border: 2px solid var(--danger-color);
  border-radius: 8px;
  background-color: #fef2f2;
}

.danger-zone h3 {
  color: var(--danger-color);
  margin-bottom: 1rem;
  font-size: 1.2rem;
}

.danger-text {
  color: var(--danger-color);
  margin-bottom: 1.5rem;
  font-weight: 500;
}

.btn-danger {
  background-color: var(--danger-color);
  border: 1px solid var(--danger-color);
  color: white;
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 500;
  transition: all 0.2s ease;
}

.btn-danger:hover {
  background-color: #c53030;
  border-color: #c53030;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(197, 48, 48, 0.3);
}
</style>

<script>
function showDeleteModal() {
    document.getElementById('deleteModal').style.display = 'flex';
}

function hideDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
}

// Fermer la modale en cliquant sur l'overlay
document.addEventListener('click', function(event) {
    const modal = document.getElementById('deleteModal');
    if (event.target === modal) {
        hideDeleteModal();
    }
});
</script>
{% endblock %}
