<div class="form-wrapper">
    <div class="form-header">
        <h2>{% if image %}Éditer l'image{% else %}Nouvelle image{% endif %}</h2>
        <button class="btn-close" type="button" onclick="document.getElementById('image-form-container').classList.add('hidden')">✕</button>
    </div>

    <form action="{% if image %}/api/image/{{ image.id }}{% else %}/api/image{% endif %}"
          method="post"
          {% if embedded %}onsubmit="return submitEmbeddedImageForm(this)"{% endif %}
          {% if not embedded %}hx-post="{% if image %}/api/image/{{ image.id }}{% else %}/api/image{% endif %}" hx-target="#images-list" hx-swap="innerHTML" hx-on::after-request="document.getElementById('image-form-container').classList.add('hidden')"{% endif %}
          enctype="multipart/form-data">

        <div class="form-grid">
            <div class="form-column">
                <div class="form-group">
                    {% if embedded %}
                    <input type="hidden" name="embedded" value="1">
                    <input type="hidden" name="select_id" value="{{ select_id }}">
                    {% endif %}
                    <label for="title">Titre *</label>
                    <input type="text" id="title" name="title" value="{{ image.title if image else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="alt_text">Texte alternatif</label>
                    <input type="text" id="alt_text" name="alt_text" value="{{ image.alt_text if image else '' }}" placeholder="Description de l'image">
                </div>
                <div class="form-group">
                    <label for="file">Fichier {% if not image %}*{% endif %}</label>
                    <input type="file" id="file" name="file" {% if not image %}required{% endif %} accept="image/*">
                </div>
            </div>
            <div class="form-column">
                {% if image %}
                <div class="form-group">
                    <label>Aperçu</label>
                    <div class="image-preview">
                        <img src="/uploads/{{ image.filename }}" alt="{{ image.alt_text or image.title }}">
                    </div>
                </div>
                <div class="form-info">
                    <p><strong>Nom de fichier:</strong> {{ image.filename }}</p>
                    <p><strong>Taille:</strong> {{ image.size_bytes or 0 }} o</p>
                    <p><strong>Type:</strong> {{ image.mime_type }}</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="form-actions">
            {% if embedded %}
            <button type="button" class="btn btn-secondary" onclick="closeEmbeddedImageModal()">Annuler</button>
            {% else %}
            <button type="button" class="btn btn-secondary" onclick="document.getElementById('image-form-container').classList.add('hidden')">Annuler</button>
            {% endif %}
            <button type="submit" class="btn btn-primary">{% if image %}Mettre à jour{% else %}Créer{% endif %}</button>
        </div>
    </form>
</div>

<style>
    .image-preview{display:flex;align-items:center;justify-content:center;background:var(--bg-color);border-radius:.5rem;overflow:hidden;aspect-ratio:4/3;border:1px dashed var(--border-color)}
    .image-preview img{max-width:100%;max-height:100%;object-fit:contain}
</style>

{% if embedded %}
<!-- Mode embarqué: le traitement est géré via hx-on::after-request sur le formulaire -->
{% endif %}


