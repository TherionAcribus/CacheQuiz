{% if current_user %}
<div id="auth-widget" class="auth-widget">
  <span>Connecté: <strong>{{ current_user.username }}</strong></span>
  {% if current_user.has_any_admin_perm() %}
  <a href="/admin" class="btn btn-outline admin-btn">⚙️ Administration</a>
  {% endif %}
  <a class="btn btn-link" href="/me">Mes stats</a>
  <form hx-post="/auth/logout" hx-target="#auth-widget" hx-swap="outerHTML" style="display:inline">
    <button class="btn btn-secondary" type="submit">Se déconnecter</button>
  </form>
</div>
{% else %}
<div id="auth-widget" class="auth-widget">
  {% if show_password_form %}
  <!-- Formulaire de connexion avec mot de passe -->
  <form class="password-login" hx-post="/auth/widget-login" hx-target="#auth-widget" hx-swap="outerHTML">
    <div class="login-fields">
      <input type="text" name="username" value="{{ login_username }}" placeholder="Votre pseudo" class="pseudo-input" readonly>
      <input type="password" name="password" placeholder="Mot de passe" class="password-input" required>
    </div>
    <button class="btn btn-primary" type="submit">Se connecter</button>
  </form>
  {% else %}
  <!-- Formulaire de connexion rapide -->
  <form class="quick-login" hx-post="/auth/quick-login" hx-target="#auth-widget" hx-swap="outerHTML">
    <input type="text" name="pseudo" placeholder="Votre pseudo" class="pseudo-input" required>
    <button class="btn btn-primary" type="submit">Entrer</button>
  </form>
  <a href="/login" class="btn btn-secondary">Se connecter</a>
  <a href="/register" class="btn btn-primary">Créer un compte</a>
  {% endif %}
</div>
{% endif %}

<style>
.auth-widget{display:flex;gap:.5rem;align-items:center}
.auth-widget .quick-login{display:flex;gap:.5rem;align-items:center}
.auth-widget .pseudo-input{padding:.75rem 1rem;font-size:1.1rem;border:2px solid rgba(255,255,255,0.3);border-radius:.5rem;background-color:rgba(255,255,255,0.1);color:white;width:200px;min-width:180px}
.auth-widget .pseudo-input::placeholder{color:rgba(255,255,255,0.7)}
.auth-widget .pseudo-input:focus{outline:none;border-color:white;background-color:rgba(255,255,255,0.2)}
.auth-widget .pseudo-input[readonly]{background-color:rgba(255,255,255,0.15);cursor:not-allowed}
.auth-widget .password-input{padding:.75rem 1rem;font-size:1.1rem;border:2px solid rgba(255,255,255,0.3);border-radius:.5rem;background-color:rgba(255,255,255,0.1);color:white;width:200px;min-width:180px}
.auth-widget .password-input::placeholder{color:rgba(255,255,255,0.7)}
.auth-widget .password-input:focus{outline:none;border-color:white;background-color:rgba(255,255,255,0.2)}
.auth-widget .login-fields{display:flex;gap:.5rem;align-items:center}
.auth-widget .password-login{display:flex;gap:.5rem;align-items:center}
.btn-link{background:transparent;border:none;color:var(--primary-color);text-decoration:underline;padding:0}
.btn-link:hover{text-decoration:none}
.admin-btn{background:transparent;border:1px solid rgba(255,255,255,0.3);color:white;padding:0.25rem 0.5rem;border-radius:0.25rem;font-size:0.85rem;text-decoration:none}
.admin-btn:hover{background:rgba(255,255,255,0.1);border-color:white}
</style>

<script>
// Mettre automatiquement le focus sur le champ mot de passe quand il est affiché
function focusPasswordField() {
    const passwordInput = document.querySelector('.password-input');
    if (passwordInput) {
        passwordInput.focus();
    }
}

// Focus au chargement initial
document.addEventListener('DOMContentLoaded', focusPasswordField);

// Focus après les mises à jour HTMX
document.addEventListener('htmx:afterSwap', function(evt) {
    if (evt.target.id === 'auth-widget') {
        focusPasswordField();
    }
});
</script>


